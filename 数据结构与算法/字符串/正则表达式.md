# RegExp: 正则表达式

正则表达式是一种查找以及字符串替换操作。正则表达式在文本编辑器中广泛使用，比如正则表达式被用于：

- 检查文本中是否含有指定的特征词
- 找出文中匹配特征词的位置
- 从文本中提取信息，比如：字符串的子串
- 修改文本

与文本编辑器相似，几乎所有的高级编程语言都支持正则表达式。在这样的语境下，“文本”也就是一个字符串，可以执行的操作都是类似的。一些编程语言(比如 Perl，JavaScript)会检查正则表达式的语法。正则表达式只是一个字符串。没有长度限制，但是，这样的正则表达式长度往往较短。如下所示是一些正则表达式的例子：

- `I had a \S+ day today`
- `[A-Za-z0-9\-_]{3,16}`
- `\d\d\d\d-\d\d-\d\d`
- `v(\d+)(\.\d+)*`
- `TotalMessages="(.*?)"`
- `<[^<>]>`

这些字符串实际上都是微型计算机程序。正则表达式的语法，实际上是一种轻量级、简洁、适用于特定领域的编程语言。记住这一点，那么你就很容易理解下面的事情：

- 每一个正则表达式，都可以分解为一个指令序列，比如“先找到这样的字符，再找到那样的字符，再从中找到一个字符。。。”
- 每一个正则表达式都有输入(文本)和输出(匹配规则的输出，有时是修改后的文本)
- 正则表达式有可能出现语法错误——不是所有的字符串都是正则表达式
- 正则表达式语法很有个性，也可以说很恐怖
- 有时可以通过编译，使得正则表达式执行更快

在实现中，正则表达式还有其他的特点。本文将重点讨论正则表达式的核心语法，在几乎所有的正则表达式中都可以见到这些规则。特别提示：正则表达式与文件通配语法无关，比如 \*.xml。最后推荐几个常用的正则表达式在线编辑工具:

- Debuggex ：https://www.debuggex.com/
- PyRegex：http://www.pyregex.com/
- Regexper：http://www.regexper.com/

## Reference

- [正则表达式详解](http://my.oschina.net/u/2448717/blog/688037?fromerr=xJU48HPy)
- [知道这 20 个正则表达式，能让你少写 1,000 行代码](http://www.tuicool.com/articles/qqURreY)
- [Useful Regex Patterns](https://projects.lukehaas.me/regexhub/?)
- [正则表达式实践篇](https://aotu.io/notes/2016/12/07/regexp-practice/)

# 基础语法

## 字符

正则表达式中包含了一系列的字符，这些字符只能匹配它们本身。有一些被称为“元字符”的特殊字符，可以匹配一些特殊规则。如下所示的例子中，我用红色标出了元字符。 ![](https://coding.net/u/hoteam/p/Cache/git/raw/master/2016/7/4/1876016D-BFF1-4967-9A28-02EB735535D7.png) 大部分的字符，包括所有的字母和数字字符，是普通字符。也就意味着，它们只能匹配它们自己，如下所示的正则表达式：

```
cat
```

意味着，只能匹配一个字符串，以“c”开头，然后是字符“a”，紧跟着是字符“t”的字符串。到目前为止，正则表达式的功能类似于

- 常规的 Find 功能
- Java 中的 `String.indexOf()` 函数
- PHP 中的 `strpos()`函数
- 等等

注意：不做特殊说明，正则表达式中是区分大小写的。但是，几乎所有正则表达式的实现，都会提供一个 Flag 用来控制是否区分大小写。

### 点 `.` 匹配任意单个字符

我们第一个要讲解的元字符是“.”。这个符号意味着可以匹配任意一个字符。如下所示的正则表达式：

```
c.t
```

意味着匹配“以 c 开头,之后是任意一个字符，紧跟着是字母 t”的字符串。在一段文本中，这样的正则表达式可以用来找出 cat, cot, czt 这样的字符串，甚至可以找出 c.t 这样的组合，但是不能找到 ct 或者是 coot 这样的字符串。使用反斜杠“\”可以忽略元字符，使得元字符的功能与普通字符一样。所以，正则表达式

```
c\.t
```

表示“找到字母 c,然后是一个句号(“.”)，紧跟着字母 t”。反斜杠本身也是一个元字符，这意味着反斜杠本身也可以通过相似的方法变回到普通字符的用途。因此，正则表达式

```
c\\t
```

表示匹配“以字符 c 开头,然后是一个反斜杠，紧跟着是字母 t”的字符串。注意！在正则表达式的实现中，.是不能用于匹配换行符的。”换行符“的表示方法在不同实现中也不同。实际编程时，请参考相关文档。在本文中，我认为.是可以匹配任意字符的。实现环境通常会提供一个 Flag 标志位，来控制这一点。

### 单次分隔符

在单词和非单词之间有单词分隔符。记住，一个单词\w 是[0-9A-Za-z_]，而非单词字符是\W(大写)，表示[^0-9a-za-z_].

在文本的开头和结尾通常也有单词分隔符。

在输入文本 it’s a cat 中，实际有八个单词分隔符。如果我们在 cat 之后在上一个空格，那就有九个单词分隔符。.

    \b表示匹配一个单词分隔符
    \b\w\w\w\b表示匹配一个三字母单词
    a\ba表示匹配两个a中间有一个单词分隔符。这个正则表达式永远不会有匹配的字符，无论输入怎样的文本。

单词分隔符本身并不是字符。它们的宽度为 0。下列正则表达式的作用不同

    (\bcat)\b
    (\bcat\b)
    \b(cat)\b
    \b(cat\b)

### 换行符

一篇文本中可以有一行或多行，行与行之间由换行符分隔，比如：

    Line一行文字
    Line break换行符
    Line一行文字
    Line break换行符
    …
    Line break换行符
    Line一行文字

注意，所有的文本都是以一行结束的，而不是以换行符结束。但是，任意一行都可能为空，包括最后一行。

行的起始位置，是在换行符和下一行首字符之间的空间。考虑到单词分隔符，文本的起始位置也可以当做是首行位置。

最后一行是最后一行的尾字符和换行符之间的空间。考虑到单词分隔符，文本的结束也可以认为是行的结束。

那么新的格式表示如下:

    Start-of-line, line, end-of-line
    Line break
    Start-of-line, line, end-of-line
    Line break
    …
    Line break
    Start-of-line, line, end-of-line

基于上述概念:

    ^表示匹配行的开始位置
    $表示匹配行的结束位置
    ^&表示一个空行
    ^.*& 表示匹配全文内容，因为行的开始符号也是一个字符，"."会匹配这个符号。找到单独的一行，可以使用 ^.*?$
    \^\$表示匹配字符串“^$”
    [$]表示匹配一个$。但是，[^]不是合法的正则表达式。记住在方括号中，字符有不同的特殊含义。要想在方括号内匹配^，必须用[\^]

与字符分隔符一样，换行符也不是字符。它们宽度为 0.如下所示的正则表达式作用不同：

    (^cat)$
    (^cat$)
    ^(cat)$
    ^(cat$)

## 字符类

字符类是一组在方括号内的字符，表示可以匹配其中的任何一个字符。

- 正则表达式 c[aeiou]t，表示可以匹配的字符串是”以 c 开头，接着是 aeiou 中的任何一个字符，最后以 t 结尾”。在文本的实际应用中，这样的正则表达式可以匹配：cat,cet,cit,cot,cut 五种字符串。
- 正则表达式[0123456789]表示匹配任意一个整数。
- 正则表达式[a]表示匹配单字符 a。

包含忽略字符的例子

- a 表示匹配字符串[a]
- [\[\]ab]表示匹配的字符为”[“或者”]”或者”a”,或者”b”
- [\\\[\]]表示匹配的字符为”\”或者 “[”或者”]”

在字符类中，字符的重复和出现顺序并不重要。[dabaaabcc]与[abc]是相同的。重要提示：字符类中和字符类外的规则有时不同，一些字符在字符类中是元字符，在字符类外是普通字符。一些字符正好相反。还有一些字符在字符类中和字符类外都是元字符，这要视情况而定！比如，.表示匹配任意一个字符，而[.]表示匹配一个全角句号。这不是一回事！

### 字符类的范围

在字符集中，你可以通过使用短横线来表示匹配字母或数字的范围。

- [b-f]与[b,c,d,e,f]相同，都是匹配一个字符”b”或”c”或”d”或”e”或”f”
- [A-Z]与[ABCDEFGHIJKLMNOPQRSTUVWXYZ]相同，都是匹配任意一个大写字母。
- [1-9]与[123456789]相同，都是匹配任意一个非零数字。

字符类可以多个混用，也可以与单个字符混合使用:

- [0-9.,]表明匹配一个数字，或者一个全角句号，或者一个逗号
- [0-9a-fA-F]意味着匹配一个十六进制数
- [a-zA-Z0-9\-]意味着匹配一个字母、数字或者一个短横线

### 字符类的反义

你可以在字符类的起始位放一个反义符。

- [^a]表示匹配任何不是“a”的字符
- [^a-za-z0-9]表示匹配任何不是字母也不是数字的字符
- [\^abc]匹配一个为“^”或者 a 或者 b 或者 c 的字符
- [^\^]表示匹配任何不为“^”的字符

譬如`[^c]ei`就表示，在 e 之前有 i，但是没有 c。

### 字符类的转义

- \d 这个正则表达式与[0-9]作用相同，都是匹配任何一个数字。(要匹配\d,应该使用正则表达式\\d)
- \w 与[0-9A-Za-z]相同，都表示匹配一个数字或字母字符
- \s 意味着匹配一个空字符(空格，制表符，回车或者换行)另外
- \D 与[^0-9]相同，表示匹配一个非数字字符。
- \W 与[^0-9a-za-z]相同，表示匹配一个非数字同时不是字母的字符。
- \S 表示匹配一个非空字符。

这些是你必须掌握的字符。你可能已经注意到了，一个全角句号“.”也是一个字符类，可以匹配任意一个字符。很多正则表达式的实现中，提供了更多的字符类，或者是标志位在 ASCII 码的基础上，扩展现有的字符类。特别提示：统一字符集中包含除了 0 至 9 之外的更多数字字符，同样的，也包含更多的空字符和字母字符。实际使用正则表达式时，请仔细查看相关文档。

## 次数/重复

在字符或字符集之后，你可以使用{ }大括号来表示重复

- 正则表达式 a{1}与 a 意思相同，都表示匹配字母 a
- a{3}表示匹配字符串“aaa”
- a{0}表示匹配空字符串。从这个正则表达式本身来看，它毫无意义。如果你对任何文本执行这样的正则表达式，你可以定位到搜索的起始位置，即使文本为空。
- a\{2\}表示匹配字符串“a{2}” 在字符类中，大括号没有特殊含义。[{}]表示匹配一个左边的大括号，或者一个右边的大括号。简化下面的正则表达式

- `z.......z`
- `\d\d\d\d-\d\d-\d\d`
- `[aeiou][aeiou][aeiou][aeiou][aeiou][aeiou]`
- `[bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz][bcdfghjklmnpqrstvwxyz]`

答案为:

- `z.{7}z`
- `\d{4}-\d{2}-\d{2}`
- `[aeiou]{6}`
- `[bcdfghjklmnpqrstvwxyz]{10}`

注意：重复字符是没有记忆性的，比如[abc]{2}表示先匹配”a 或者 b 或者 c”，再匹配”a 或者 b 或者 c”，与匹配”aa 或者 ab 或者 ac 或者 ba 或者 bb 或者 bc 或者 ca 或者 cb 或者 cc“一样。[abc]{2}并不能表示匹配”aa 或者 bb 或者 cc“

### 指定重复次数范围

重复次数是可以指定范围的

- x{4,4}与 x{4}相同
- colou{0,1}r 表示匹配 colour 或者 color
- a{3,5}表示匹配 aaaaa 或者 aaaa 或者 aaa

注意这样的正则表达式会优先匹配最长字符串，比如输入 ` I had an aaaaawful day``会匹配单词aaaaawful中的aaaaa，而不会匹配其中的aaa。 `

重复次数是可以有范围的，但是有时候这样的方法也不能找到最佳答案。如果你的输入文本是 I had an aaawful daaaaay 那么在第一次匹配时，只能找到 aaawful，只有再次执行匹配时才能找到 daaaaay 中的 aaaaa.

重复次数的范围可以是开区间

- a{1，}表示匹配一个或一个以上的连续字符 a。依然是匹配最长字符串。当找到第一个 a 之后，正则表达式会尝试匹配尽量多个的连续字母 a。
- .{0,}表示匹配任意内容。无论你输入的文本是什么，即使是一个空字符串，这个正则表达式都会成功匹配全文并返回结果。

### 重复的转义字符

- ？与{0,1}相同，比如，colou?r 表示匹配 colour 或者 color
- *与{0,}相同。比如，.*表示匹配任意内容
- +与{1，}相同。比如,\w+表示匹配一个词。其中”一个词”表示由一个或一个以上的字符组成的字符串，比如\_var 或者 AccountName1.

这些是你必须知道的常用转义字符，除此之外还有:

- \?\*\+ 表示匹配字符串”?\*+”
- [?*+]表示匹配一个问号，或者一个\*号，或者一个加号

# 匹配策略

## 非贪婪匹配

正则表达式 “.\*” 表示匹配双引号，之后是任意内容，之后再匹配一个双引号。注意，其中匹配任意内容也可以是双引号。通常情况下，这并不是很有用。通过在句尾加上一个问号，可以使得字符串重复不再匹配最长字符。

- \d{4,5}?表示匹配\d\d\d\d 或者\d\d\d\d\d。也就是和\d{4}一样
- colou??r 与 colou{0,1}r 相同，表示找到 color 或者 colour。这与 colou?r 一样。
- “.\*?”表示先匹配一个双引号，然后匹配最少的字符，然后是一个双引号，与上面两个例子不同，这很有用。

## 分组匹配

你可以使用括号表示分组:

    通过使用 Mon|Tues|Wednes|Thurs|Fri|Satur|Sun)day 匹配一周中的某一天
    (\w*)ility  与 \w*ility 相同。都是匹配一个由”ility”结尾的单词。稍后我们会讲解，为何第一种方法更加有用。
    [()]表示匹配任意一个左括号或者一个右括号

分组可以包括空字符串：

    (red|blue)表示匹配red或者blue或者是一个空字符串
    abc()def与abcdef相同

你也可以在分组的基础上使用重复：

    (red|blue)？与(red|blue|)相同
    \w+(\s+\w+)表示匹配一个或多个由空格分隔的单词

# 常用正则表达式

## 图片

```
/http[s]?:\/\/(?:[a-z0-9\-]+\.)+[a-z]{2,6}(?:[^/#?]+)+\.(?:jpg|gif|png)/ig
```

[正则之基本入门](https://segmentfault.com/a/1190000004389850)

| 规则                 | 说明                                                                    |
| -------------------- | ----------------------------------------------------------------------- |
| /a/                  | 匹配字符 a                                                              |
| /\?/                 | 匹配特殊字符?。特殊字符包括^, \$, ? , ., /, \, [, ], {, }, (, ), +, \*. |
| .                    | 匹配任意字符，例如/a./匹配 ab 和 ac。                                   |
| /[ab]c/              | 匹配 ac 和 bc,[]之间代表范围,例如：/[a-z]/ , /[a-zA-Z0-9]/。            |
| /[^a-za-z0-9]/       | 匹配不在该范围内的字符串                                                |
| /[\d]/               | 代表任意数字                                                            |
| /[\w]/               | 代表任意字母，数字或者\_                                                |
| /[\s]/               | 代表空白字符，包括空格，TAB 和换行                                      |
| /[\D]/,/[\W]/,/[\S]/ | 均为上述的否定情况                                                      |
| ?                    | 代表 0 或 1 个字符                                                      |
| \*                   | 代表 0 或多个字符                                                       |
| +                    | 代表 1 或多个字符                                                       |
| /d{3}/               | 匹配 3 个数字                                                           |
| /d{1,10}/            | 匹配 1-10 个数字                                                        |
| d{3,}/               | 匹配 3 个数字以上                                                       |
| /([A-Z]\d){5}/       | 匹配首位是大写字母，后面 4 个是数字的字符串                             |
